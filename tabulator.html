<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Suivi dâ€™installation - Tabulator</title>

  <!-- Lien vers Tabulator en local -->
  <link href="Tabulator-master/dist/css/tabulator.min.css" rel="stylesheet">
  <script src="Tabulator-master/dist/js/tabulator.min.js"></script>

  <style>
    body { font-family: sans-serif; margin: 30px; }
    h2 { margin-bottom: 20px; }
    /* Un peu de couleur comme dans ton Excel */
    .type-col { background-color: #fce5cd; }        /* orange clair */
    .install-col { background-color: #fff2cc; }     /* jaune clair */
    .lots-col { background-color: #d9ead3; }        /* vert clair */
    .artefact-col { background-color: #cfe2f3; }    /* bleu clair */
  </style>
</head>
<body>

<h2>ðŸ“Š Suivi des installations</h2>
<div id="tableau"></div>

<script>
  // DonnÃ©es dâ€™exemple
  const data = [
    {mois:"janv-25", t1:3, t2:2, t3:1, t4:0, t5:0, delaiOK:22, delaiKO:3, livraisonOK:20, livraisonKO:1, totalLots:12, lotConnus:9, nouvVersion:2, nouvLots:1, totalArt:5, majArt:3},
    {mois:"fÃ©vr-25", t1:1, t2:3, t3:2, t4:1, t5:0, delaiOK:18, delaiKO:4, livraisonOK:17, livraisonKO:0, totalLots:10, lotConnus:7, nouvVersion:2, nouvLots:1, totalArt:4, majArt:2},
    {mois:"mars-25", t1:2, t2:4, t3:1, t4:0, t5:0, delaiOK:20, delaiKO:2, livraisonOK:19, livraisonKO:1, totalLots:9, lotConnus:8, nouvVersion:1, nouvLots:0, totalArt:3, majArt:1}
  ];

  // DÃ©finition du tableau
  new Tabulator("#tableau", {
    data: data,
    layout: "fitDataStretch",
    movableColumns: true,
    resizableColumns: true,
    columns: [
      {title:"Mois", field:"mois", frozen:true, headerSort:false},

      // --- GROUPE 1 : TYPE ---
      {title:"Type", columns:[
        {title:"1", field:"t1", hozAlign:"center", cssClass:"type-col"},
        {title:"2", field:"t2", hozAlign:"center", cssClass:"type-col"},
        {title:"3", field:"t3", hozAlign:"center", cssClass:"type-col"},
        {title:"4", field:"t4", hozAlign:"center", cssClass:"type-col"},
        {title:"5", field:"t5", hozAlign:"center", cssClass:"type-col"},
      ]},

      // --- GROUPE 2 : INSTALLATIONS ---
      {title:"DÃ©lai et nombre de livraison", columns:[
        {title:"DÃ©lai OK", field:"delaiOK", hozAlign:"center", cssClass:"install-col"},
        {title:"DÃ©lai KO", field:"delaiKO", hozAlign:"center", cssClass:"install-col"},
        {title:"Livraison OK", field:"livraisonOK", hozAlign:"center", cssClass:"install-col"},
        {title:"Livraison KO", field:"livraisonKO", hozAlign:"center", cssClass:"install-col"},
      ]},

      // --- GROUPE 3 : LOTS ---
      {title:"Lots", columns:[
        {title:"Total", field:"totalLots", hozAlign:"center", cssClass:"lots-col"},
        {title:"Lots connus", field:"lotConnus", hozAlign:"center", cssClass:"lots-col"},
        {title:"Nouv. version", field:"nouvVersion", hozAlign:"center", cssClass:"lots-col"},
        {title:"Nouveaux lots", field:"nouvLots", hozAlign:"center", cssClass:"lots-col"},
      ]},

      // --- GROUPE 4 : ARTEFACTS ---
      {title:"Artefacts", columns:[
        {title:"Total", field:"totalArt", hozAlign:"center", cssClass:"artefact-col"},
        {title:"Mis Ã  jour", field:"majArt", hozAlign:"center", cssClass:"artefact-col"},
      ]},
    ]
  });
</script>

</body>
</html>

// Ton jeu de donnÃ©es
var tableData = [
  {
    "id": 27,
    "i_mois": "12/2024",
    "i_t1": 1,
    "i_t2": 9,
    "i_t3": 14,
    "i_t4": 14,
    "i_t5": 4,
    "i_delais_ok": 22,
    "i_delais_ko": {
      "nb": 4,
      "tickets": [44150, 44158, 44187, 44023]
    },
    "i_livraison_ok": 31,
    "i_livraison_ko": {
      "nb": 2,
      "tickets": [44170, 44172]
    },
    "i_nb_lots": 300,
    "i_nb_known_lot": 265,
    "i_nb_new_lot": 0,
    "i_nb_new_version": 35,
    "i_nb_artefacts": 1441,
    "i_nb_maj_artefacts": 1269
  }
];

var table = new Tabulator("#example-table", {
  data: tableData,
  layout: "fitColumns",
  columns: [
    {title: "Mois", field: "i_mois"},
    {title: "T1", field: "i_t1"},
    {title: "T2", field: "i_t2"},
    {title: "T3", field: "i_t3"},
    {title: "T4", field: "i_t4"},
    {title: "T5", field: "i_t5"},
    
    // ðŸ‘‰ Colonne spÃ©ciale pour i_delais_ko
    {
      title: "DÃ©lai KO",
      field: "i_delais_ko.nb",   // affiche le nombre
      tooltip: function(cell){
        let data = cell.getRow().getData();
        let tickets = data.i_delais_ko?.tickets || [];
        return tickets.length ? "Tickets : " + tickets.join(", ") : "Aucun ticket";
      },
    },

    // MÃªme principe pour i_livraison_ko
    {
      title: "Livraison KO",
      field: "i_livraison_ko.nb",
      tooltip: function(cell){
        let data = cell.getRow().getData();
        let tickets = data.i_livraison_ko?.tickets || [];
        return tickets.length ? "Tickets : " + tickets.join(", ") : "Aucun ticket";
      },
    },
  ]
});

#######
new Tabulator("#tableau", {
    data: data,
    layout: "fitDataStretch",
    initialSort: [
        {column: "i_mois", dir: "desc"} // tri par dÃ©faut: le plus rÃ©cent d'abord
    ],
    columns: [
        {
            title: "Mois",
            field: "i_mois",
            sorter: function(a, b, aRow, bRow, column, dir, sorterParams){
                // Format attendu: "MM/YYYY"
                const [ma, ya] = a.split("/").map(Number);
                const [mb, yb] = b.split("/").map(Number);

                // Compare d'abord par annÃ©e, puis par mois
                if (ya !== yb) return ya - yb;
                return ma - mb;
            },
            hozAlign: "center",
        },
        {
            title: "DÃ©lai KO",
            field: "i_delais_ko.nb",
            tooltip: function(cell){
                let tickets = cell.getRow().getData().i_delais_ko?.tickets || [];
                return tickets.length ? "Tickets : " + tickets.join(", ") : "Aucun ticket";
            },
        },
    ]
});


#######
new Tabulator("#tableau", {
    data: data,
    layout: "fitDataStretch",
    columns: [
        { title: "Mois", field: "i_mois" },

        {
            title: "DÃ©lai KO",
            field: "i_delais_ko.nb",
            tooltip: function(e, cell, onRendered) {
                const rowData = cell.getRow().getData();
                const delais = rowData.i_delais_ko;

                // Sâ€™il nâ€™y a pas de KO, on ne montre rien
                if (!delais || delais.nb <= 0) {
                    return false; // ðŸ‘‰ dÃ©sactive le tooltip
                }

                // CrÃ©ation du contenu DOM du tooltip
                const el = document.createElement("div");
                el.style.padding = "6px 10px";
                el.style.background = "#333";
                el.style.color = "white";
                el.style.borderRadius = "6px";
                el.style.maxWidth = "250px";

                el.innerHTML = `
                    <b>${delais.nb} ticket${delais.nb > 1 ? 's' : ''}</b><br>
                    ${delais.tickets.join(", ")}
                `;

                return el;
            },
        },

        {
            title: "Livraison KO",
            field: "i_livraison_ko.nb",
            tooltip: function(e, cell, onRendered) {
                const rowData = cell.getRow().getData();
                const liv = rowData.i_livraison_ko;

                if (!liv || liv.nb <= 0) {
                    return false;
                }

                const el = document.createElement("div");
                el.style.padding = "6px 10px";
                el.style.background = "#333";
                el.style.color = "white";
                el.style.borderRadius = "6px";

                el.innerHTML = `
                    <b>${liv.nb} ticket${liv.nb > 1 ? 's' : ''}</b><br>
                    ${liv.tickets.join(", ")}
                `;

                return el;
            },
        },
    ]
});